# cargo-nx: Package Formats

Build format fields used for building must be placed inside `[package.metadata.nx.<format>]` in `Cargo.toml`. These fields vary depending on the project's format.

The program itself detects the target format when parsing `Cargo.toml`. Note that multiple formats at the same time are not currently supported.

Projects without specific build format fields, like libraries, can also be compiled. This can be useful to later generate custom executables instead of being generated by this subcommand.

## NRO

Projects which generate homebrew NRO binaries don't have any mandatory fields, but only optional ones.

- Example:

```toml
[package]
name = "Project"
version = "0.1.0"
authors = ["XorTroll"]
edition = "2021"

[package.metadata.nx.nro]
romfs = "romfs_dir"
icon = "icon.jpg"
nacp = { default_name = "Sample project", default_author = "XorTroll", version = "0.1 beta" }
```

> Note: the `romfs` and `icon` fields must point to items located relative to the project's directory

The fields present on the `nacp` object, all of them optional, are the following:

| Field                  | Value                                                            | Description                                               | Default value           |
|------------------------|------------------------------------------------------------------|-----------------------------------------------------------|-------------------------|
| default_name           | String (max size 0x200)                                          | Default title name                                        | Unknown application     |
| default_author         | String (max size 0x100)                                          | Default application author                                | Unknown author          |
| version                | String (max size 0x10)                                           | Application version                                       | <required field>        |
| application_id         | Hex-String u64                                                   | Application ID                                            | 0000000000000000        |
| add_on_content_base_id | Hex-String u64                                                   | Base ID for add-on content (DLC)                          | application_id + 0x1000 |
| titles                 | Object of language titles                                        | Language-specific application name/author values          | Default values above    |
| presence_group_id      | Hex-String u64                                                   | Presence group ID                                         | application_id          |
| save_data_owner_id     | Hex-String u64                                                   | Save-data owner ID                                        | application_id          |
| isbn                   | String (max size 0x25)                                           | ISBN                                                      | Empty string            |
| startup_user_account   | "None", "Required", "RequiredWithNetworkServiceAccountAvailable" | Whether the application requires a user account on launch | "None"                  |
| attribute              | "None", "Demo", "RetailInteractiveDisplay"                       | Application attribute                                     | "None"                  |
| screenshot             | "Allow", "Deny"                                                  | Screenshot control                                        | "Allow"                 |
| video_capture          | "Disabled", "Enabled", "Automatic"                               | Video capture control                                     | "Disabled"              |
| logo_type              | "LicensedByNintendo", "Nintendo"                                 | Logo type                                                 | "LicensedByNintendo"    |
| logo_handling          | "Auto", "Manual"                                                 | Logo handling                                             | "Auto"                  |
| crash_report           | "Deny", "Allow"                                                  | Crash report control                                      | "Allow"                 |
| bcat_passphrase        | String (max size 0x41)                                           | BCAT passphrase                                           | Empty string            |
| program_index          | u8                                                               | Program index                                             | 0                       |

> Note: default name/author and application ID are not actual NACP fields, but they are used as the default value for various fields, as the table shows.

### Available languages

| Language names       | Language codes |
|----------------------|----------------|
| AmericanEnglish      | en-US          |
| BritishEnglish       | en-UK          |
| Japanese             | ja             |
| French               | fr             |
| German               | de             |
| LatinAmericanSpanish | es-419         |
| Spanish              | es             |
| Italian              | it             |
| Dutch                | nl             |
| CanadianFrench       | fr-CA          |
| Portuguese           | pt             |
| Russian              | ru             |
| Korean               | ko             |
| TraditionalChinese   | zh-TW          |
| SimplifiedChinese    | zh-CN          |
| BrazilianPortuguese  | pt-BR          |

> Note: languages in the titles object can be specified by their names or their codes, as the JSON example above shows.

- Example with specific languages:

```toml
[package]
name = "Multi-language"
version = "0.2.0"
authors = ["XorTroll"]
edition = "2021"

[package.metadata.nx.nro.nacp]
default_name = "A"
default_author = "B"
version = "0.2 beta"
titles = { ja = { name = "J" }, LatinAmericanSpanish = { author = "X" }, it = { name = "I", author = "T" } }
```

```bash
Names/authors produced above:

- Japanese: "J", "B"
- LatinAmericanSpanish: "A", "X"
- Italian: "I", "T"
- Other languages: "A", "B"
```

> Note: only `name` and `author` fields can be language-specific

## NSP

Projects which generate sysmodule NSP exefs packages need a single, mandatory field for the NPDM data, which would be `npdm` for specifying it on the TOML itself or `npdm_json` for using an external JSON file:

- Example:

```toml
[package]
name = "Project"
version = "0.2.10"
authors = ["XorTroll"]
edition = "2021"

[package.metadata.nx.nsp.npdm]
name = "ProjectNpdm"
signature_key_generation = 0
main_thread_stack_size = "0x20000"
main_thread_priority = 49
main_thread_core_number = 3
system_resource_size = 0
version = 0
address_space_type = 1
is_64_bit = true
optimize_memory_allocation = false
disable_device_address_space_merge = false
is_production = true
unqualified_approval = false
memory_region = 2
program_id = "0x0100AAAABBBBCCCC"

[package.metadata.nx.nsp.npdm.fs_access_control]
flags = "0xFFFFFFFFFFFFFFFF"

[package.metadata.nx.nsp.npdm.service_access_control]
accessed_services = [ "fsp-srv", "ncm" ]
hosted_services = [ "demo:srv" ]

[package.metadata.nx.nsp.npdm.kernel_capabilities]
highest_priority = 63
lowest_priority = 16
max_core_number = 3
min_core_number = 3
enable_system_calls = [
    "SetHeapSize"
]
kernel_version = "3.0"
```

- Example using an external NPDM JSON:

```toml
[package]
name = "Project"
version = "0.2.10"
authors = ["XorTroll"]
edition = "2021"

[package.metadata.nx.nsp]
npdm_json = "npdm.json"
```

> Note: the NPDM JSON file follows the same format used in most other homebrews (check projects like [Atmosphere](https://github.com/Atmosphere-NX/Atmosphere/blob/master/stratosphere/sm/sm.json), [emuiibo](https://github.com/XorTroll/emuiibo/blob/master/emuiibo/npdm.json), [ldn_mitm](https://github.com/spacemeowx2/ldn_mitm/blob/master/ldn_mitm/res/app.json)...) and, like with the paths in the NRO format, it must be relative to the project's directory

## Libraries

Library projects have nothing special in their Cargo.toml.

## Credits

- [linkle](https://github.com/MegatonHammer/linkle) libraries as the core element of this project
- [cargo-count](https://github.com/kbknapp/cargo-count) as the example followed to make a cargo subcommand project
- [Icons8](https://icons8.com/) for using one of their Nintendo Switch icons as the base for the default NRO icon
